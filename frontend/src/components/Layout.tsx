import { Mic, Zap, Library, Terminal } from 'lucide-react';
import { BrandLogo } from './BrandLogo';
import { useLocation, useNavigate } from 'react-router-dom';

interface LayoutProps {
  children: React.ReactNode;
  headerRight?: React.ReactNode;
  showLogs?: boolean;
  onToggleLogs?: () => void;
  queueCount?: number;
}

export const Layout: React.FC<LayoutProps> = ({ children, headerRight, showLogs, onToggleLogs, queueCount }) => {
  const location = useLocation();
  const navigate = useNavigate();

  // Derive active tab from path
  const getActiveTab = () => {
    const path = location.pathname;
    if (path === '/' || path.startsWith('/project/')) return 'library';
    if (path.startsWith('/queue')) return 'queue';
    if (path.startsWith('/voices')) return 'voices';
    return 'library';
  };

  const activeTab = getActiveTab();

  const navItems = [
    { id: 'library', label: 'Library', icon: Library, path: '/' },
    { id: 'queue', label: 'Queue', icon: Zap, path: '/queue' },
    { id: 'voices', label: 'Voices', icon: Mic, path: '/voices' },
  ];

  return (
    <div style={{ display: 'flex', flexDirection: 'column', minHeight: '100vh', width: '100vw', backgroundColor: 'var(--bg)' }}>
      <header className="header-container" style={{
        height: 'var(--header-height, 72px)',
        width: '100%',
        position: 'fixed',
        top: 0,
        left: 0,
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'space-between',
        padding: '0 2rem',
        zIndex: 100,
        backgroundColor: 'rgba(255, 255, 255, 0.8)',
        backdropFilter: 'blur(20px)',
        borderBottom: '1px solid var(--border)',
      }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '2.5rem' }}>
          {/* Logo Section */}
          <div
            style={{ cursor: 'pointer', display: 'flex', alignItems: 'center' }}
            onClick={() => navigate('/')}
          >
            <BrandLogo scale={0.8} showIcon={true} />
          </div>

          {/* Navigation Section */}
          <nav style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
            {navItems.map((item) => (
              <button
                key={item.id}
                onClick={() => navigate(item.path)}
                className="btn-ghost"
                style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  padding: '8px 16px',
                  borderRadius: 'var(--radius-button)',
                  background: activeTab === item.id ? 'var(--accent-glow)' : 'transparent',
                  color: activeTab === item.id ? 'var(--accent)' : 'var(--text-secondary)',
                  position: 'relative',
                  transition: 'all 0.2s ease',
                  border: 'none',
                  boxShadow: 'none'
                }}
              >
                <item.icon size={16} strokeWidth={activeTab === item.id ? 2.5 : 2} />
                <span className="nav-label" style={{ fontWeight: 600, fontSize: '0.9rem' }}>{item.label}</span>
                {item.id === 'queue' && queueCount !== undefined && queueCount > 0 && (
                   <div style={{ 
                       background: 'var(--accent)', 
                       color: 'white', 
                       borderRadius: '6px', 
                       padding: '1px 6px', 
                       fontSize: '0.7rem', 
                       fontWeight: 700, 
                       marginLeft: '4px' 
                   }}>{queueCount}</div>
                )}
                {activeTab === item.id && (
                  <div style={{
                    position: 'absolute',
                    bottom: '4px',
                    left: '16px',
                    right: '16px',
                    height: '2px',
                    background: 'var(--accent)',
                    borderRadius: '2px'
                  }} />
                )}
              </button>
            ))}
          </nav>
        </div>

        {/* Global Controls Section */}
        <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
          {onToggleLogs && (
            <button
              onClick={onToggleLogs}
              className="btn-ghost"
              title={showLogs ? "Hide Console" : "Show Console"}
              style={{
                width: '40px',
                height: '40px',
                borderRadius: 'var(--radius-button)',
                color: showLogs ? 'var(--accent)' : 'var(--text-secondary)',
                background: showLogs ? 'var(--accent-glow)' : 'transparent',
                border: '1px solid ' + (showLogs ? 'var(--accent-glow)' : 'var(--border)'),
                transition: 'all 0.2s ease',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: 0
              }}
            >
              <Terminal size={18} strokeWidth={2} />
            </button>
          )}
          {headerRight}
        </div>
      </header>

      <main className="mobile-padding" style={{
        flex: 1,
        marginTop: 'var(--header-height, 72px)',
        width: '100%',
        minHeight: 'calc(100vh - 72px)',
        position: 'relative',
        display: 'flex',
        flexDirection: 'column',
        padding: '3rem 2.5rem'
      }}>
        <div style={{ maxWidth: '1600px', width: '100%', margin: '0 auto' }}>
          {children}
        </div>
      </main>
    </div>
  );
};
